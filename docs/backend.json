{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Aravalli Configurator app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The user's username for login.",
          "format": "string"
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profileName": {
          "type": "string",
          "description": "The user's display name.",
          "format": "string"
        },
        "registrationDate": {
          "type": "string",
          "description": "The date and time the user registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "Party": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Party",
      "type": "object",
      "description": "Represents a party (customer/vendor) for invoicing.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the party."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this party."
        },
        "name": {
          "type": "string",
          "description": "The name of the party."
        },
        "mobile": {
          "type": "string",
          "description": "The party's mobile number."
        },
        "email": {
          "type": "string",
          "description": "The party's email address.",
          "format": "email"
        },
        "address": {
          "type": "string",
          "description": "The party's full address."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the party was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "mobile"
      ]
    },
    "Invoice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invoice",
      "type": "object",
      "description": "Represents an invoice created for a party.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the invoice."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this invoice."
        },
        "partyId": {
          "type": "string",
          "description": "Reference to the Party this invoice belongs to."
        },
        "items": {
          "type": "array",
          "description": "List of items in the invoice.",
          "items": {
            "type": "object",
            "properties": {
              "product": {
                "type": "string"
              },
              "qty": {
                "type": "number"
              },
              "rate": {
                "type": "number"
              },
              "total": {
                "type": "number"
              }
            },
            "required": [
              "product",
              "qty",
              "rate",
              "total"
            ]
          }
        },
        "grandTotal": {
          "type": "number",
          "description": "The total amount of the invoice."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the invoice was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "partyId",
        "items",
        "grandTotal"
      ]
    },
    "FurnitureItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FurnitureItem",
      "type": "object",
      "description": "Represents a type of furniture item available for configuration.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the furniture item."
        },
        "name": {
          "type": "string",
          "description": "The name of the furniture item (e.g., 'PVC Chair', 'PVC Table')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the furniture item."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the furniture item.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl"
      ]
    },
    "Material": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Material",
      "type": "object",
      "description": "Represents a material option for furniture customization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the material."
        },
        "name": {
          "type": "string",
          "description": "The name of the material (e.g., 'White PVC', 'Brown PVC')."
        },
        "color": {
          "type": "string",
          "description": "The color of the material (e.g., '#FFFFFF', '#4A300E')."
        },
        "texture": {
          "type": "string",
          "description": "The texture of the material (e.g., 'Smooth', 'Rough')."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of an image representing the material.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "color",
        "texture"
      ]
    },
    "Configuration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Configuration",
      "type": "object",
      "description": "Represents a saved furniture configuration created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the configuration."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Configuration)"
        },
        "furnitureItemId": {
          "type": "string",
          "description": "Reference to FurnitureItem. (Relationship: FurnitureItem 1:N Configuration)"
        },
        "materialId": {
          "type": "string",
          "description": "Reference to Material. (Relationship: Material 1:N Configuration)"
        },
        "height": {
          "type": "number",
          "description": "The height of the configured furniture item."
        },
        "width": {
          "type": "number",
          "description": "The width of the configured furniture item."
        },
        "depth": {
          "type": "number",
          "description": "The depth of the configured furniture item."
        },
        "configurationDate": {
          "type": "string",
          "description": "The date and time the configuration was saved.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "furnitureItemId",
        "materialId",
        "height",
        "width",
        "depth"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a recommendation generated by the AI for material or size.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Recommendation)"
        },
        "furnitureItemId": {
          "type": "string",
          "description": "Reference to FurnitureItem. (Relationship: FurnitureItem 1:N Recommendation)"
        },
        "materialId": {
          "type": "string",
          "description": "Reference to Material. (Relationship: Material 1:N Recommendation)"
        },
        "recommendedHeight": {
          "type": "number",
          "description": "The AI recommended height."
        },
        "recommendedWidth": {
          "type": "number",
          "description": "The AI recommended width."
        },
        "recommendedDepth": {
          "type": "number",
          "description": "The AI recommended depth."
        },
        "reason": {
          "type": "string",
          "description": "The reason for the AI recommendation."
        },
        "recommendationDate": {
          "type": "string",
          "description": "The date and time the recommendation was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "furnitureItemId",
        "reason"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Contains private user data. Only the user can read/write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/furniture_items/{furnitureItemId}",
        "definition": {
          "entityName": "FurnitureItem",
          "schema": {
            "$ref": "#/backend/entities/FurnitureItem"
          },
          "description": "Stores available furniture items. Publicly readable.",
          "params": [
            {
              "name": "furnitureItemId",
              "description": "The unique identifier of the furniture item."
            }
          ]
        }
      },
      {
        "path": "/materials/{materialId}",
        "definition": {
          "entityName": "Material",
          "schema": {
            "$ref": "#/backend/entities/Material"
          },
          "description": "Stores available material options. Publicly readable.",
          "params": [
            {
              "name": "materialId",
              "description": "The unique identifier of the material."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/configurations/{configurationId}",
        "definition": {
          "entityName": "Configuration",
          "schema": {
            "$ref": "#/backend/entities/Configuration"
          },
          "description": "Stores saved furniture configurations for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "configurationId",
              "description": "The unique identifier of the configuration."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores AI recommendations for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "recommendationId",
              "description": "The unique identifier of the recommendation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/parties/{partyId}",
        "definition": {
          "entityName": "Party",
          "schema": {
            "$ref": "#/backend/entities/Party"
          },
          "description": "Stores parties for each user. Only the user can read/write their own parties.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "partyId",
              "description": "The unique identifier of the party."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/invoices/{invoiceId}",
        "definition": {
          "entityName": "Invoice",
          "schema": {
            "$ref": "#/backend/entities/Invoice"
          },
          "description": "Stores invoices for each user. Only the user can read/write their own invoices.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "invoiceId",
              "description": "The unique identifier of the invoice."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Aravalli Configurator app's features, focusing on furniture customization, AI-powered recommendations, and user-specific data. The design emphasizes Authorization Independence (CRITICAL) and supports the required QAPs. User-owned data is stored under the `/users/{userId}` path, ensuring that security rules can easily control access based on the authenticated user's ID. The denormalization strategy involves storing the `userId` within each `Configuration` and `Recommendation` document, eliminating the need for `get()` calls in security rules to verify ownership. This directly addresses Authorization Independence. \n\nQAPs are supported by the structural segregation of user data and globally available data (furniture items, materials). List operations are secured by ensuring that only the authenticated user can access configurations and recommendations under their respective `/users/{userId}` path. The `furniture_items` and `materials` collections support public read access, allowing for easy listing and display of available options.\n\nSpecifically:\n\n*   `/users/{userId}` collections ensure private user data.\n*   `configurations` subcollections under `/users/{userId}` store configurations owned by the user.\n*   `recommendations` subcollections under `/users/{userId}` store AI recommendations for each user.\n*   `furniture_items` and `materials` are globally accessible, enabling easy browsing and filtering.\n*   `parties` and `invoices` subcollections under `/users/{userId}` store user-specific invoicing data."
  }
}